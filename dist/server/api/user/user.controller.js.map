{"version":3,"sources":["api/user/user.controller.js"],"names":["index","list","exp","create","show","submit","destroy","select","reject","changePassword","me","authCallback","json2csv","require","request","validationError","res","statusCode","err","status","json","handleError","send","req","find","exec","then","users","catch","fields","csv","data","setHeader","set","newUser","body","provider","role","save","user","token","sign","_id","secrets","session","expiresIn","options","method","url","headers","authorization","process","env","CASITE","personalizations","to","email","name","subject","from","content","type","value","error","response","Error","next","userId","params","id","findById","end","profile","phonenumber","wnumber","previous","prevyear","social","fblink","college","address","city","state","education","degree","branch","year","postal","pin","questions","why","right","past","submitted","success","findByIdAndRemove","message","selected","oldPass","String","oldPassword","newPass","newPassword","authenticate","password","findOne","redirect"],"mappings":"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","file":"user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\nvar json2csv = require('json2csv');\nvar request = require(\"request\");\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    return res.status(statusCode).json(err);\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    return res.status(statusCode).send(err);\n  };\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  return User.find({}, '-salt -password').exec()\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\nexport function list(req, res) {\n  return User.find({}, '-salt -password -provider -role').exec()\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\nexport function exp(req, res) {\n  return User.find({}, '-_id -salt -password -provider -role').exec()\n    .then(users => {\n      var fields = ['name', 'email', 'college.address', 'college.city', 'college.name', 'college.state',\n      'education.branch', 'education.degree', 'education.year', 'phonenumber', 'previous', 'prevyear',\n      'postal.address', 'postal.city', 'postal.pin', 'postal.state', 'questions.past', 'questions.right',\n      'questions.why', 'social', 'wnumber', 'fblink'];\n      var csv = json2csv({ data: users, fields: fields});\n      res.setHeader('Content-disposition', 'attachment; filename=users.csv');\n      res.set('Content-Type', 'text/csv');\n      res.status(200).send(csv);\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Creates a new user\n */\nexport function create(req, res) {\n  var newUser = new User(req.body);\n  newUser.provider = 'local';\n  newUser.role = 'user';\n  return newUser.save()\n    .then(function(user) {\n      var token = jwt.sign({ _id: user._id }, config.secrets.session, {\n        expiresIn: 60 * 60 * 5\n      });\n      var options = { method: 'POST',\n        url: 'https://api.sendgrid.com/v3/mail/send',\n        headers:\n         { 'content-type': 'application/json',\n           authorization: 'Bearer ' + process.env.CASITE },\n        body:\n        { personalizations:\n           [ { to: [ { email: user.email, name: 'Akshay' } ],\n               subject: 'Shaastra 2018 || Campus Ambassador' } ],\n          from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n          //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n          subject: 'Shaastra 2018 || Campus Ambassador',\n          content:\n           [ { type: 'text/html',\n               value: '<html><body><p>Hello '+user.name+ ',<br>Greetings from Shaastra 2018, IIT Madras! <br><br>Thank you for signing up for the Shaastra Campus Ambassador Program. Please complete the questionnaire on the portal by 25th August 2017.<br> You will be intimidated by mail if you are selected to become a Campus Ambassador. Meanwhile please like and follow our Facebook page: fb.com/Shaastra for updates.<br> If you have any queries contact us on studentrelations@shaastra.org <br><br><br>Regards, <br>Team Shaastra <br> IIT Madras</p></body></html>' } ] },\n        json: true };\n\n        request(options, function (error, response, body) {\n    if (error) throw new Error(error);\n\n    //console.log(response);\n  });\n    res.json({ token });\n    })\n    .catch(validationError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  var userId = req.params.id;\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if(!user) {\n        return res.status(404).end();\n      }\n      res.json(user.profile);\n    })\n    .catch(err => next(err));\n}\n\nexport function submit(req, res) {\n  return User.findById(req.user._id).exec()\n    .then(user => {\n      user.phonenumber = req.body.phonenumber;\n      user.wnumber = req.body.wnumber;\n      user.previous = req.body.previous;\n      user.prevyear = req.body.prevyear;\n      user.social = req.body.social;\n      user.fblink = req.body.fblink;\n      user.college.name = req.body.college.name;\n      user.college.address = req.body.college.address;\n      user.college.city = req.body.college.city;\n      user.college.state = req.body.college.state;\n      user.education.degree = req.body.education.degree;\n      user.education.branch = req.body.education.branch;\n      user.education.year = req.body.education.year;\n      user.postal.address = req.body.postal.address;\n      user.postal.city = req.body.postal.city;\n      user.postal.state = req.body.postal.state;\n      user.postal.pin = req.body.postal.pin;\n      user.questions.why = req.body.questions.why;\n      user.questions.right = req.body.questions.right;\n      user.questions.past = req.body.questions.past;\n      user.submitted = true;\n      return user.save()\n        .then(() => {\n          res.json({success: true});\n        })\n        .catch(handleError(res));\n    });\n}\n\n/**\n * Deletes a user\n * restriction: 'admin'\n */\nexport function destroy(req, res) {\n  return User.findByIdAndRemove(req.params.id).exec()\n    .then(function() {\n      res.status(204).end();\n    })\n    .catch(handleError(res));\n}\n\nexport function select(req, res) {\n  return User.findById(req.params.id).exec()\n    .then(function(user) {\n      if(!user)\n      {\n        res.json({success: false,message: \"No User found\"});\n      }\n      else{\n      user.selected=1;\n      return user.save()\n        .then(() => {\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.CASITE },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: 'Akshay' } ],\n                   subject: 'Shaastra 2018 || Campus Ambassador' } ],\n              from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2018 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: '<html><body><p>Hello ' +user.name+ ',<br><br> Greetings from Shaastra 2018, IIT Madras! <br><br>First of all, congratulations on being selected as a Campus Ambassador for your college. We would like to welcome you to the team behind India’s largest completely student-run technical extravaganza - Shaastra 2018.<br>With a strong team of 500 students of IIT Madras and hundreds of Campus Ambassadors across India, Shaastra 2018 aims to give the best technical experience to everyone in the country ranging from school students to engineers of the future.<br>With this in mind, we hope you have an amazing journey working with us as you represent your college.<br>Further instructions and information would be communicated to you shortly. We request you to keep checking the CA Portal as well as your email.<br><br>Looking forward to work with you.<br><br>Regards,<br>Team Shaastra<br>IIT Madras</p></body></html>' } ] },\n            json: true };\n\n            request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n\n        //console.log(response);\n      });\n          res.json({success: true, message: \"User updated\"});\n        })\n        .catch(handleError(res));\n     }\n    })\n    .catch(handleError(res));\n}\n\nexport function reject(req, res) {\n  return User.findById(req.params.id).exec()\n    .then(function(user) {\n      if(!user)\n      {\n        res.status(400).json({message: \"No User found\"});\n      }\n      else{\n      user.selected=2;\n      var name=user.name,email=user.email;\n      return user.save()\n        .then(() => {\n          var options = { method: 'POST',\n            url: 'https://api.sendgrid.com/v3/mail/send',\n            headers:\n             { 'content-type': 'application/json',\n               authorization: 'Bearer ' + process.env.CASITE },\n            body:\n            { personalizations:\n               [ { to: [ { email: user.email, name: 'Akshay' } ],\n                   subject: 'Shaastra 2018 || Campus Ambassador' } ],\n              from: { email: 'studentrelations@shaastra.org', name: 'Student Relations, Shaastra' },\n              //reply_to: { email: 'sam.smith@example.com', name: 'Sam Smith' },\n              subject: 'Shaastra 2018 || Campus Ambassador',\n              content:\n               [ { type: 'text/html',\n                   value: '<html><body><p>Hello '+user.name+ ',<br><br> Greetings from Shaastra 2018, IIT Madras! <br><br>We regret to inform you that your application for being a Shaastra Campus Ambassador couldn’t be accommodated. However, lose hope not, for you can try again for next year - which will see a bigger CA Program.<br>Till then, get a feel of Shaastra - visit the IIT Madras campus in January and experience the largest student-run technical extravaganza. With a host of workshops, international competitions, lectures, exhibitions and shows, Shaastra is bound to amaze you.<br><br>We look forward to see you at Shaastra 2018, and as a Campus Ambassador next year!<br><br>Regards,<br>Team Shaastra<br>IIT Madras</p></body></html>' } ] },\n            json: true };\n\n            request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n\n        //console.log(response);\n      });\n          res.status(200).json({message: \"User updated\"});\n        })\n        .catch(handleError(res));\n     }\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Change a users password\n */\nexport function changePassword(req, res) {\n  var userId = req.user._id;\n  var oldPass = String(req.body.oldPassword);\n  var newPass = String(req.body.newPassword);\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if(user.authenticate(oldPass)) {\n        user.password = newPass;\n        return user.save()\n          .then(() => {\n            res.status(204).end();\n          })\n          .catch(validationError(res));\n      } else {\n        return res.status(403).end();\n      }\n    });\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  var userId = req.user._id;\n\n  return User.findOne({ _id: userId }, '-salt -password').exec()\n    .then(user => { // don't ever give out the password or salt\n      if(!user) {\n        return res.status(401).end();\n      }\n      res.json(user);\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res) {\n  res.redirect('/');\n}\n"]}